<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Paramore by iancooper</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
<div class="wrapper">
    <header>
        <h1>Paramore</h1>
        <p>Libraries and supporting examples for use with the Ports and Adapters and CQRS architectural styles for .NET, with support for Task Queues</p>
        <p class="view"><a href="https://github.com/iancooper/Paramore">View the Project on GitHub <small>iancooper/Paramore</small></a></p>
        <ul>
            <li><a href="https://github.com/iancooper/Paramore/zipball/master">Download <strong>ZIP File</strong></a></li>
            <li><a href="https://github.com/iancooper/Paramore/tarball/master">Download <strong>TAR Ball</strong></a></li>
            <li><a href="https://github.com/iancooper/Paramore">View On <strong>GitHub</strong></a></li>
        </ul>
        <p><a href="index.html">Paramore Home</a></p>
        <p><a href="Brighter.html">Brighter Home</a></p>
        <p><a href="ImplementingDistributedTaskQueue.html">Next</a></p>
        <p><a href="PolicyFallback.html">Prev</a></p>
    </header>
    <section>
        <h1>Brighter</h1>
        <h2>Monitoring</h2>
        <p>Brighter emits monitoring information from Task Queues using a configured <a href="ControlBus.html">Control Bus</a></p>
        <h3>Configuring Monitoring</h3>
        <p>Firstly <a href="ControlBus.html#configure">configure a Control Bus</a> in the  brighter application to emit monitoring messages</p>

        <h3>Config file</h3>
        <p>Monitoring requires a new section to be added to the application config file:</p>
        <pre><code>&lt;configSections&gt;
&lt;section name=&quot;monitoring&quot; type =&quot;paramore.brighter.commandprocessor.monitoring.Configuration.MonitoringConfigurationSection, paramore.brighter.commandprocessor&quot; allowLocation =&quot;true&quot; allowDefinition=&quot;Everywhere&quot;/&gt;
&lt;/configSections&gt;</code></pre>

        <p>
            The monitoring config can then be speicified later in the file:
        </p>
        <pre><code>&lt;monitoring&gt;
    &lt;monitor isMonitoringEnabled=&quot;true&quot; instanceName=&quot;ManagementAndMonitoring&quot;/&gt;
&lt;/monitoring&gt;</code></pre>
        <p>This enables runtime changes to enable/disable emitting of monitoring messages.</p>

        <h3>Handler confguration</h3>
        <p>Each handler that requires monitoring must be configured in two stages, a Handler attribute and container registration of a MonitorHandler for the given request:</p>

        <p>For example, given:</p>
        <ul>
            <li>TRequest - a Brighter Request, inheriting from IRequest</li>
            <li>TRequestHandler - handles the TRequest, inheriting IHandleRequest &lt;TRequest&gt;</li>
        </ul>
        
        <h4>Attribute</h4>
        <p>The following attribute must be added to the Handle method in the handler, TRequestHandler:</p>
        <pre><code>[Monitor(step:1, timing:HandlerTiming.Before, handlerType:typeof(TRequestHandler))]</code></pre>
        <p>Please note the step and timing can vary if monitoring should be after another attribute step, or timing should be emitted after.</p>

        <h4>Container registration</h4>
        <p>The following additional handler must be registered in the application container (where <code>MonitorHandler&lt;T&gt;</code> is a built-in Brighter handler):</p>

        <pre><code>container.Register&lt;TRequest, MonitorHandler&lt;TRequest&gt;&gt;</code></pre>

        <h3>Monitor message format</h3>
        <p>A message is emitted from the Control Bus on Handler Entry and Handler Exit. The following is the form of the message:</p>
        <pre><code>{
    &quot;Exception&quot;: null or Exception message,
    &quot;EventType&quot;: &quot;EnterHandler or ExitHandler&quot;,
    &quot;EventTime&quot;: &quot;2016-06-21T15:48:26.1390192Z&quot;,
    &quot;TimeElapsedMs&quot;: 0 or Duration,
    &quot;HandlerName&quot;: &quot;...&quot;,
    &quot;HandlerFullAssemblyName&quot;: &quot;...&quot;,
    &quot;InstanceName&quot;: &quot;ManagementAndMonitoring&quot;,
    &quot;RequestBody&quot;: &quot;{\&quot;Id\&quot;:\&quot;dc32b35f-bc75-4197-9178-c8310a63e4fb\&quot;, ... }&quot;,
    &quot;Id&quot;: &quot;048cc207-e820-40fa-b931-55b60203fbc2&quot;
}</code></pre>

        <p>Messages can be processed from the queue and interated with your monitoring tool of choice, for example Live python consumers emitting to console or logstash consumption to the ELK stack using relevant plugins to provide performance raditators or dashboards.</p>
    </section>
    <footer>
        <p>This project is maintained by <a href="https://github.com/iancooper">iancooper</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
    </footer>
</div>
<script src="javascripts/scale.fix.js"></script>
</body>
</html>