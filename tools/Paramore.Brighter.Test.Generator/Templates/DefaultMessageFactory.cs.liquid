// <auto-generated>
// This file is auto-generated by Paramore.Brighter.Test.Generator
// </auto-generated>

using System;
using System.Net.Mime;

using Paramore.Brighter.Observability;

namespace {{ Namespace }};

/// <summary>
/// Default implementation of <see cref="IAmAMessageFactory"/> that creates messages with randomly generated test data.
/// </summary>
public class DefaultMessageFactory : IAmAMessageFactory
{
    private static Random s_random = new();

    /// <summary>
    /// Creates a new message instance with randomly generated header values and body content for testing purposes.
    /// </summary>
    /// <param name="timestamp">The timestamp for the message. If null, the current UTC time will be used.</param>
    /// <returns>A new <see cref="Message"/> instance with randomly generated test data.</returns>
    public Message Create(DateTimeOffset? timestamp = null)
    {
        var messageHeader = new MessageHeader(
            messageId: Id.Random(),
            topic: new RoutingKey(Uuid.NewAsString()),
            messageType: MessageType.MT_DOCUMENT,
            source: new Uri(Uuid.NewAsString(), UriKind.Relative),
            type: new CloudEventsType(Uuid.NewAsString()),
            timeStamp: timestamp ?? DateTimeOffset.UtcNow,
            correlationId: Id.Random(),
            replyTo: new RoutingKey(Uuid.NewAsString()),
            contentType: new ContentType(MediaTypeNames.Text.Plain),
            partitionKey: Uuid.NewAsString(),
            dataSchema: new Uri("https://schema.test"),
            subject: Uuid.NewAsString(),
            delayed: TimeSpan.FromMilliseconds(5),
            traceParent: "00-abcdef0123456789-abcdef0123456789-01",
            traceState: "state123",
            baggage: new Baggage(),
            workflowId: Id.Random(),
            jobId: Id.Random());

        messageHeader.Bag.Add("header1", Uuid.NewAsString());
        messageHeader.Bag.Add("header2", Uuid.NewAsString());
        messageHeader.Bag.Add("header3", Uuid.NewAsString());
        messageHeader.Bag.Add("header4", Uuid.NewAsString());
        messageHeader.Bag.Add("header5", Uuid.NewAsString());

        return new Message(messageHeader, new MessageBody(Uuid.NewAsString()));
    }
}