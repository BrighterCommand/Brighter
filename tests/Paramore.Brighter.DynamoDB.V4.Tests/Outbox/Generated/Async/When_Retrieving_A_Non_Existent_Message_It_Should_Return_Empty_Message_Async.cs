// <auto-generated>
// This file is auto-generated by Paramore.Brighter.Test.Generator
// </auto-generated>

using Xunit;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace Paramore.Brighter.DynamoDB.V4.Tests.Outbox.Async;

public class WhenRetrievingANonExistentMessageItShouldReturnEmptyMessageAsync : IAsyncLifetime
{
    private readonly IAmAnOutboxProviderAsync _outboxProvider;
    private readonly IAmAMessageFactory _messageFactory;
    private List<Message> _createdMessages = [];

    public WhenRetrievingANonExistentMessageItShouldReturnEmptyMessageAsync()
    {
        _outboxProvider = new Paramore.Brighter.DynamoDB.V4.Tests.Outbox.DynamoDBOutboxProvider();

        _messageFactory = new DefaultMessageFactory();
    }

    public async ValueTask InitializeAsync()
    {
        await _outboxProvider.CreateStoreAsync();
    }

    public async ValueTask DisposeAsync()
    {
        await _outboxProvider.DeleteStoreAsync(_createdMessages);
    }

    [Fact]
    public async Task When_Retrieving_A_Non_Existent_Message_It_Should_Return_Empty_Message_Async()
    {
        // Arrange
        var context = new RequestContext();
        
        var outbox = _outboxProvider.CreateOutboxAsync();
        
        // Act
        var message = await outbox.GetAsync(Id.Random(), context);

        // Assert
        Assert.Equal(MessageType.MT_NONE, message.Header.MessageType);
    }
}
